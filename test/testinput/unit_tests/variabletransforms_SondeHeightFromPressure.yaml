#
#=== Pressure to height conversion for vertical profile ===#
#

window begin: 2015-01-08T20:30:00Z
window end: 2015-01-09T03:30:00Z

observations:
# UKMO method (uses ICAO atmosphere).
- obs space:
    name: Radiosonde
    obsdatain:
      obsfile: Data/ufo/testinput_tier_1/met_office_conversion_pressure2height.nc4
      obsgrouping:
        group variables: ["station_id"]
        sort variable: "datetime"
        sort order: "descending"
    simulated variables: [air_temperature, relative_humidity, geopotential_height, dew_point_temperature]
  obs filters:
  - filter: Variable Transforms
    Transform: ["HeightFromPressure"]
    Method: UKMO
  compareVariables:
  - test:
      name: geopotential_height@DerivedObsValue
    reference:
      name: geopotential_height_ICAO_reference@ObsValue
    relTol: 1.0e-5

# NCAR-RAL method (uses approximation for pressures > 120 hPa, ICAO atmosphere otherwise).
- obs space:
    name: Radiosonde
    obsdatain:
      obsfile: Data/ufo/testinput_tier_1/met_office_conversion_pressure2height.nc4
      obsgrouping:
        group variables: ["station_id"]
        sort variable: "datetime"
        sort order: "descending"
    simulated variables: [air_temperature, relative_humidity, geopotential_height, dew_point_temperature]
  obs filters:
  - filter: Variable Transforms
    Transform: ["HeightFromPressure"]
    Method: NCAR
  compareVariables:
  - test:
      name: geopotential_height@DerivedObsValue
    reference:
      name: geopotential_height_NCAR_reference@ObsValue
    relTol: 1.0e-5

# Vertical coordinate is air_pressure_levels.
- obs space:
    name: Radiosonde
    obsdatain:
      obsfile: Data/ufo/testinput_tier_1/met_office_conversion_pressure2height_levels.nc4
      obsgrouping:
        group variables: ["station_id"]
        sort variable: "datetime"
        sort order: "descending"
    simulated variables: [air_temperature, relative_humidity, geopotential_height, dew_point_temperature]
  obs filters:
  - filter: Variable Transforms
    Transform: ["HeightFromPressure"]
    Method: UKMO
  compareVariables:
  - test:
      name: geopotential_height_levels@DerivedObsValue
    reference:
      name: geopotential_height_levels_ICAO_reference@ObsValue
    relTol: 1.0e-5

Assign constant observation error value:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [ 100000, 90000, 80000, 90000, 100000]
  station_id: [ 1, 1, 1, 1, 1]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error parameter: 1.2
  expected_obserror: [1.2, 1.2, 1.2, 1.2, 1.2]
Assign observation error from NetCDF variance; 1 exact; 1 linear (along the first axis):
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [ 2, 4, 6, 8, 10]
  observation_type: [0, 1, 2, 3, 4]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance.nc
          interpolation:
          - name: observation_type@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: linear
  expected_obserror_variance: [375.5, 601, 242.5, 175, 337]
Assign observation error from NetCDF variance; 1 nearest; 1 linear (along the second axis):
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -6, -6, -6, -4 ]
        lons: [ 30, 35, 40, 45 ]
        datetimes: [ '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z' ]
      obs errors: [1.0]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_latitude_longitude.nc
          interpolation:
          - name: latitude@MetaData
            method: nearest
          - name: longitude@MetaData
            method: linear
  expected_obserror_variance: [1, 1.5, 2, 5.5]
Assign observation error from NetCDF variance; 1 exact; 1 nearest:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [ 1, 2, 4, 13, 35]
  observation_type: [0, 1, 2, 3, 4]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance.nc
          interpolation:
          - name: observation_type@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: nearest
  expected_obserror_variance: [278, 755, 397, 846, 676]
Assign observation error from NetCDF full matrix; 3 exact; 1 nearest:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  satellite_id:      [ 0, 0,  1, 1,  1 ]
  processing_center: [ 0, 1,  0, 1,  0 ]
  latitude_band:     [ 6, 11, 4, 30, 7 ]
  channel_number:    [ 0, 1,  2, 3,  4 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_with_extract_fullr.nc
          interpolation:
          - name: channel_number@MetaData
            method: exact
          - name: satellite_id@MetaData
            method: exact
          - name: processing_center@MetaData
            method: exact
          - name: latitude_band@MetaData
            method: nearest
  expected_obserror_variance: [685, 431, 771, 25, 805]
Assign observation error from NetCDF full matrix; 3 exact; 1 nearest; demonstrating yaml order respected with sorting:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  satellite_id:      [ 0, 0,  1, 1,  1 ]
  processing_center: [ 0, 1,  0, 1,  0 ]
  latitude_band:     [ 6, 11, 4, 30, 7 ]
  channel_number:    [ 0, 1,  2, 3,  4 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_with_extract_fullr.nc
          interpolation:
          - name: processing_center@MetaData
            method: exact
          - name: satellite_id@MetaData
            method: exact
          - name: latitude_band@MetaData
            method: nearest
          - name: channel_number@MetaData
            method: exact
  expected_obserror_variance: [685, 431, 771, 25, 805]
Assign observation error from NetCDF full matrix 2D; 1 exact:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  channel_number:    [ 2, 0, 4, 7, 5 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_2d_fullr.nc
          interpolation:
          - name: channel_number@MetaData
            method: exact
  expected_obserror_variance: [88, 685, 798, 618, 544]
Assign observation error from NetCDF variance; 3 exact (1 string, 1 datetime):
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: exact
          - name: datetime@MetaData
            method: exact
  expected_obserror_variance: [278, 487, 917, 178, 289]
Assign observation error from NetCDF variance; attempt at using 'nearest' for strings:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: nearest
  expectExceptionWithMessage: Nearest match not compatible with string type
Assign observation error from NetCDF variance; attempt at using 'linear' for strings:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: linear
  expectExceptionWithMessage: linear interpolation not compatible with string type
Assign observation error from NetCDF variance; 1 least upper bound; 1 exact:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [ 300, 300, 300, 301, 301, 301]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: least upper bound
          - name: station_id@MetaData
            method: exact
  expected_obserror_variance: [1, 2, 3, 4, 5, 6]
Assign observation error from NetCDF variance; 1 greatest lower bound; 1 exact:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [ 599, 599, 599, 600, 600, 600]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: greatest lower bound
          - name: station_id@MetaData
            method: exact
  expected_obserror_variance: [1, 2, 3, 4, 5, 6]
Assign observation error from NetCDF variance; no match found for a 'least upper bound' variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [ 300, 300, 10000, 301, 301, 301]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: least upper bound
          - name: station_id@MetaData
            method: exact
  expectExceptionWithMessage: No match found for 'least upper bound' extraction of value '10000' of the variable 'air_pressure@MetaData'
Assign observation error from NetCDF variance; no match found for a 'greatest lower bound' variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [ 599, 599, 100, 600, 600, 600]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: greatest lower bound
          - name: station_id@MetaData
            method: exact
  expectExceptionWithMessage: No match found for 'greatest lower bound' extraction of value '100' of the variable 'air_pressure@MetaData'
Assign observation error from NetCDF variance; attempt to use the 'least upper bound' mode for a string variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: least upper bound
  expectExceptionWithMessage: The 'least upper bound' method cannot be used for string variables
Assign observation error from NetCDF variance; attempt to use the 'greatest lower bound' mode for a string variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z', '2010-01-01T00:00:00Z',
                     '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z' ]
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: greatest lower bound
  expectExceptionWithMessage: The 'greatest lower bound' method cannot be used for string variables
Assign observation error from NetCDF variance; multi-channel variable support:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [brightness_temperature]
    channels: &all_channels 1-2
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        datetimes: [ '2010-01-01T00:00:00Z', '2010-01-01T01:00:00Z', '2010-01-01T02:00:00Z',
                     '2010-01-01T03:00:00Z', '2010-01-01T04:00:00Z' ]
      obs errors: [1.0, 1.0]
  satellite_id:      [ 0, 0,  1, 1,  1 ]
  processing_center: [ 0, 1,  0, 1,  0 ]
  latitude_band:     [ 6, 11, 4, 30, 7 ]
  ObsError assign:
    filter variables:
    - name: brightness_temperature
      channels: *all_channels
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        channels: *all_channels
        options:
          channels: *all_channels
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_with_extract_fullr.nc
          interpolation:
          - name: satellite_id@MetaData
            method: exact
          - name: processing_center@MetaData
            method: exact
          - name: latitude_band@MetaData
            method: nearest
#  python-iris debug command: et = cube[2, 2, 5]; meta=[f"{coord.name()}: {coord.points[0]}" for coord in et.coords()]; print(f"data={et.data} {meta}")
#  data[1,1,0]=871   ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 0', 'latitude_band@MetaData: 5', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 0']
#  data[1,1,3]=431   ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 3', 'latitude_band@MetaData: 15', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 0']
#  data[1,1,4]=83    ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 4', 'latitude_band@MetaData: 3', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
#  data[1,1,7]=399   ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 7', 'latitude_band@MetaData: 46', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 1']
#  data[1,1,5]=92    ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 5', 'latitude_band@MetaData: 8', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
#  data[2,2,0]=87.0  ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 0', 'latitude_band@MetaData: 5', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 0']
#  data[2,2,3]=12.0  ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 3', 'latitude_band@MetaData: 15', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 0']
#  data[2,2,4]=771.0 ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 4', 'latitude_band@MetaData: 3', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
#  data[2,2,7]=33.0  ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 7', 'latitude_band@MetaData: 46', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 1']
#  data[2,2,5]=308.0 ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 5', 'latitude_band@MetaData: 8', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
  expected_obserror_variance: [871, 431, 83, 399, 92, 87, 12, 771, 33, 308]
